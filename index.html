<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consumo de Diésel</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header-container">
        <div class="header-content">
            <img src="logo.jpg" alt="Logo Obreco" class="header-logo">
            <div class="header-titles">
                <h1>GRUPO OBRECO CIA LTDA</h1>
                <h2>CONTROL DE DIESEL</h2>
            </div>
        </div>
        <button id="btn-logout" class="button-danger no-print" style="display: none;"><i class="fa-solid fa-right-from-bracket"></i>Cerrar Sesión</button>
    </div>

    <div class="container no-print">
        <div class="main-tabs">
            <button class="main-tab-link active" id="btnTabRegistrar"><i class="fa-solid fa-pencil"></i>Registrar</button>
            <button class="main-tab-link" id="btnTabReportes"><i class="fa-solid fa-chart-pie"></i>Reportes</button>
            <button class="main-tab-link" id="btnTabHistorial"><i class="fa-solid fa-list-ul"></i>Historial Detallado</button>
            <button class="main-tab-link" id="btnTabAdmin"><i class="fa-solid fa-gear"></i>Administración</button>
        </div>
    </div>

    <div id="main-content-area">
        <div id="vista-login">
            <div class="login-container">
                <form id="login-form">
                    <h3>Iniciar Sesión</h3>
                    <input type="email" id="login-email" placeholder="Correo electrónico" required>
                    <input type="password" id="login-password" placeholder="Contraseña" required>
                    <button type="submit" class="button-primary">Ingresar</button>
                </form>
            </div>
            <div class="credits">
                APLICACION ELABORADA POR: ING. JOSE LUIS MACAS P.
            </div>
        </div>

        <div id="vista-app" style="display: none;">
            <div id="tabRegistrar" class="main-tab-content no-print" style="display: block;">
                <div class="container">
                    <h2><i class="fa-solid fa-file-circle-plus"></i>Registros de Consumo</h2>
                    <p>Haz clic en el botón para añadir un nuevo registro de consumo de diésel.</p>
                    <button id="btnAbrirModal" class="button-primary"><i class="fa-solid fa-plus"></i>Nuevo Registro</button>
                </div>
                <div id="modalRegistro" class="modal"><div class="modal-content"><span class="close-button">&times;</span><div id="formularioContainer"><h2 id="formularioTitulo">Nuevo Registro</h2><form id="consumoForm"><input type="hidden" id="registroId"><label for="fecha">Fecha:</label><input type="date" id="fecha" required><label for="hora">Hora de Carga:</label><input type="time" id="hora"><label for="numeroFactura">Número de Factura:</label><input type="text" id="numeroFactura" placeholder="Ej: 001-001-123456789"><label for="selectChofer">Nombre del Chofer:</label><select id="selectChofer" required></select><label for="selectVolqueta">Placa de la Volqueta:</label><select id="selectVolqueta" required></select><label for="selectDetallesVolqueta">Detalles Volqueta:</label><select id="selectDetallesVolqueta"></select> <label for="kilometraje">Kilometraje:</label><input type="number" id="kilometraje" step="any" placeholder="Ej: 150230.5"><label for="selectProveedor">Proveedor de Diesel:</label><select id="selectProveedor" required></select><label for="selectProyecto">Proyecto:</label><select id="selectProyecto" required></select><label for="galones">Galones de Diésel (Volumen):</label><input type="number" id="galones" step="0.01" required><label for="costo">Costo Total ($):</label><input type="number" id="costo" step="0.01" required><label for="selectEmpresa">Empresa:</label><select id="selectEmpresa" required></select><label for="descripcion">Descripción del Uso:</label><textarea id="descripcion" required></textarea><button type="submit" id="btnGuardar" class="button-primary"><i class="fa-solid fa-floppy-disk"></i>Guardar Registro</button></form></div></div></div>
            </div>
            
            <div id="tabReportes" class="main-tab-content"><div class="container no-print"><div class="filter-section"><div class="filter-group"><div><label for="filtroMesReportes">Por Mes:</label><select id="filtroMesReportes" class="filtro-sincronizado" data-sync-id="filtroMes"></select></div><div><label for="filtroFechaInicioReportes">Por Rango:</label><input type="date" id="filtroFechaInicioReportes" class="filtro-sincronizado" data-sync-id="filtroFechaInicio" title="Desde la Fecha"></div><div><label for="filtroFechaFinReportes">-</label><input type="date" id="filtroFechaFinReportes" class="filtro-sincronizado" data-sync-id="filtroFechaFin" title="Hasta la Fecha"></div></div><div class="filter-group"><div><label for="filtroChoferReportes">Por Chofer:</label><select id="filtroChoferReportes" class="filtro-sincronizado" data-sync-id="filtroChofer"></select></div><div><label for="filtroProveedorReportes">Por Proveedor:</label><select id="filtroProveedorReportes" class="filtro-sincronizado" data-sync-id="filtroProveedor"></select></div><div><label for="filtroEmpresaReportes">Por Empresa:</label><select id="filtroEmpresaReportes" class="filtro-sincronizado" data-sync-id="filtroEmpresa"></select></div><div><label for="filtroProyectoReportes">Por Proyecto:</label><select id="filtroProyectoReportes" class="filtro-sincronizado" data-sync-id="filtroProyecto"></select></div></div><div class="filter-group"><button id="btnAplicarFiltros" class="button-success"><i class="fa-solid fa-filter"></i>Aplicar Filtros</button><button id="btnLimpiarFiltros" class="button-secondary"><i class="fa-solid fa-eraser"></i>Limpiar Filtros</button><button class="button-info btn-print" data-print-target="tabReportes" style="margin-left: auto;"><i class="fa-solid fa-print"></i>Imprimir Reporte</button></div></div></div><div class="container" id="loaderContainer"><h2 id="loadingMessage" class="loader">Cargando datos desde la nube...</h2></div><div class="container report-cards-container"><div class="report-card"><div class="card-header"><i class="fa-solid fa-building"></i><h3>Por Empresa</h3></div><div class="card-body"><table id="resumenEmpresaTabla"><thead><tr><th>Empresa</th><th>Galones</th><th>Costo ($)</th></tr></thead><tbody id="resumenEmpresaBody"></tbody><tfoot id="resumenEmpresaFooter"></tfoot></table></div></div><div class="report-card"><div class="card-header"><i class="fa-solid fa-dolly"></i><h3>Por Proveedor</h3></div><div class="card-body"><table id="resumenProveedorTabla"><thead><tr><th>Proveedor</th><th>Galones</th><th>Costo ($)</th></tr></thead><tbody id="resumenProveedorBody"></tbody><tfoot id="resumenProveedorFooter"></tfoot></table></div></div><div class="report-card"><div class="card-header"><i class="fa-solid fa-list-check"></i><h3>Por Proyecto</h3></div><div class="card-body"><table id="resumenProyectoTabla"><thead><tr><th>Proyecto</th><th>Galones</th><th>Costo ($)</th></tr></thead><tbody id="resumenProyectoBody"></tbody><tfoot id="resumenProyectoFooter"></tfoot></table></div></div><div class="report-card"><div class="card-header"><i class="fa-solid fa-user-tie"></i><h3>Por Chofer</h3></div><div class="card-body"><table id="resumenChoferTabla"><thead><tr><th>Chofer</th><th>Galones</th><th>Costo ($)</th></tr></thead><tbody id="resumenChoferBody"></tbody><tfoot id="resumenChoferFooter"></tfoot></table></div></div><div class="report-card"><div class="card-header"><i class="fa-solid fa-truck"></i><h3>Por Placa</h3></div><div class="card-body"><table id="resumenTabla"><thead><tr><th>Placa</th><th>Galones</th><th>Costo ($)</th></tr></thead><tbody id="resumenBody"></tbody><tfoot id="resumenFooter"></tfoot></table></div></div></div></div>

            <div id="tabHistorial" class="main-tab-content"><div class="container no-print"><div class="filter-section"><div class="filter-group"><div><label for="filtroMesHistorial">Por Mes:</label><select id="filtroMesHistorial" class="filtro-sincronizado" data-sync-id="filtroMes"></select></div><div><label for="filtroFechaInicioHistorial">Por Rango:</label><input type="date" id="filtroFechaInicioHistorial" class="filtro-sincronizado" data-sync-id="filtroFechaInicio" title="Desde la Fecha"></div><div><label for="filtroFechaFinHistorial">-</label><input type="date" id="filtroFechaFinHistorial" class="filtro-sincronizado" data-sync-id="filtroFechaFin" title="Hasta la Fecha"></div></div><div class="filter-group"><div><label for="filtroChoferHistorial">Por Chofer:</label><select id="filtroChoferHistorial" class="filtro-sincronizado" data-sync-id="filtroChofer"></select></div><div><label for="filtroProveedorHistorial">Por Proveedor:</label><select id="filtroProveedorHistorial" class="filtro-sincronizado" data-sync-id="filtroProveedor"></select></div><div><label for="filtroEmpresaHistorial">Por Empresa:</label><select id="filtroEmpresaHistorial" class="filtro-sincronizado" data-sync-id="filtroEmpresa"></select></div><div><label for="filtroProyectoHistorial">Por Proyecto:</label><select id="filtroProyectoHistorial" class="filtro-sincronizado" data-sync-id="filtroProyecto"></select></div></div><div class="filter-group"><button id="btnAplicarFiltros" class="button-success"><i class="fa-solid fa-filter"></i>Aplicar Filtros</button><button id="btnLimpiarFiltros" class="button-secondary"><i class="fa-solid fa-eraser"></i>Limpiar Filtros</button><button class="button-info btn-print" data-print-target="tabHistorial" style="margin-left: auto;"><i class="fa-solid fa-print"></i>Imprimir Historial</button></div><small class="print-suggestion no-print">Sugerencia: Para mejor visualización, configure la impresión en orientación Horizontal.</small></div></div><div class="container"><button class="accordion-button active">TOTAL DE CONSUMO DE DIESEL (HISTORIAL DETALLADO)</button><div class="accordion-panel" style="max-height: fit-content;"><div class="table-container"><table id="historialTabla"><thead><tr><th class="no-print">Acciones</th><th class="no-print">Distribuir</th> <th>Fecha</th><th>Hora</th><th>Factura #</th><th>Chofer</th><th>Placa</th><th>Detalles Volqueta</th><th>Kilometraje</th><th>Proveedor</th><th>Proyecto</th><th>Galones</th><th>Costo ($)</th><th>Empresa</th><th>Descripción</th></tr></thead><tbody id="historialBody"></tbody><tfoot id="historialFooter"></tfoot></table></div></div></div></div>

            <div id="tabAdmin" class="main-tab-content no-print">
                <div class="container" id="adminContainer"><h2><i class="fa-solid fa-screwdriver-wrench"></i>Administración</h2><div class="admin-section"><div class="admin-box"><h3><i class="fa-solid fa-user-tie"></i>Gestionar Choferes</h3><form id="formAdminChofer" class="admin-form"><input type="text" id="nuevoChofer" placeholder="Nombre del chofer" required><button type="submit" class="button-success"><i class="fa-solid fa-plus"></i>Agregar</button></form><ul id="listaChoferes" class="lista-gestion"></ul></div><div class="admin-box"><h3><i class="fa-solid fa-truck"></i>Gestionar Placas</h3><form id="formAdminPlaca" class="admin-form"><input type="text" id="nuevaPlaca" placeholder="Placa de la volqueta" required><button type="submit" class="button-success"><i class="fa-solid fa-plus"></i>Agregar</button></form><ul id="listaPlacas" class="lista-gestion"></ul></div><div class="admin-box"><h3><i class="fa-solid fa-tags"></i>Gestionar Detalles Volqueta</h3><form id="formAdminDetallesVolqueta" class="admin-form"><input type="text" id="nuevoDetalleVolqueta" placeholder="Ej: Doble Eje, Tritón Rojo" required><button type="submit" class="button-success"><i class="fa-solid fa-plus"></i>Agregar</button></form><ul id="listaDetallesVolqueta" class="lista-gestion"></ul></div>
                 <div class="admin-box"><h3><i class="fa-solid fa-tractor"></i>Gestionar Maquinaria</h3><form id="formAdminMaquinaria" class="admin-form"><input type="text" id="nuevaMaquinaria" placeholder="Ej: Rodillo Dynapac, CAT 320" required><button type="submit" class="button-success"><i class="fa-solid fa-plus"></i>Agregar</button></form><ul id="listaMaquinaria" class="lista-gestion"></ul></div>
                <div class="admin-box"><h3><i class="fa-solid fa-building"></i>Gestionar Empresas</h3><form id="formAdminEmpresa" class="admin-form"><input type="text" id="nuevaEmpresa" placeholder="Nombre de la empresa" required><button type="submit" class="button-success"><i class="fa-solid fa-plus"></i>Agregar</button></form><ul id="listaEmpresas" class="lista-gestion"></ul></div><div class="admin-box"><h3><i class="fa-solid fa-dolly"></i>Gestionar Proveedores</h3><form id="formAdminProveedor" class="admin-form"><input type="text" id="nuevoProveedor" placeholder="Nombre del proveedor" required><button type="submit" class="button-success"><i class="fa-solid fa-plus"></i>Agregar</button></form><ul id="listaProveedores" class="lista-gestion"></ul></div><div class="admin-box"><h3><i class="fa-solid fa-list-check"></i>Gestionar Proyectos</h3><form id="formAdminProyecto" class="admin-form"><input type="text" id="nuevoProyecto" placeholder="Nombre del proyecto" required><button type="submit" class="button-success"><i class="fa-solid fa-plus"></i>Agregar</button></form><ul id="listaProyectos" class="lista-gestion"></ul></div></div></div>
            </div>
            
            <div class="signature-block"><div class="line"></div>Ing. José L. Macas P.<br>RESIDENTE DE OBRA</div>
        </div>
    </div>
    
    <div id="modalDistribucion" class="modal">
        <div class="modal-content">
            <span class="close-button" id="cerrarModalDistribucion">&times;</span>
            <h2><i class="fa-solid fa-share-from-square"></i> Registrar Distribución de Diésel</h2>
            
            <div id="distribucionInfoCarga" style="background-color: #f8f9fa; padding: 10px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #ddd;">
                <strong>Carga Original:</strong><br>
                Fecha: <span id="distInfoFecha"></span> | 
                Volqueta: <span id="distInfoVolqueta"></span> | 
                Galones Cargados: <span id="distInfoGalonesCargados"></span><br>
                Galones Ya Distribuidos: <span id="distInfoGalonesDistribuidos"></span> |
                Galones Restantes: <span id="distInfoGalonesRestantes"></span>
            </div>

            <form id="distribucionForm">
                <input type="hidden" id="distribucionConsumoId"> 
                
                <label for="selectDistMaquinaria">Maquinaria Receptora:</label>
                <select id="selectDistMaquinaria" required></select>
                
                <label for="distGalonesSuministrados">Galones a Suministrar:</label>
                <input type="number" id="distGalonesSuministrados" step="0.01" required>
                
                <label for="selectDistProyecto">Proyecto (Opcional):</label>
                <select id="selectDistProyecto"></select>
                
                <label for="distDescripcion">Descripción (Opcional):</label>
                <textarea id="distDescripcion"></textarea>
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button type="submit" id="btnGuardarDistribucion" class="button-primary"><i class="fa-solid fa-plus"></i> Guardar Distribución</button>
                    <button type="button" id="btnFinalizarDistribucion" class="button-secondary" style="margin-left: auto;"><i class="fa-solid fa-door-closed"></i> Cerrar</button>
                </div>
            </form>
            
            <div style="margin-top: 25px;">
                <h4>Distribuciones Registradas para esta Carga:</h4>
                <ul id="distribucionesAnterioresLista" style="font-size: 0.9em; max-height: 150px; overflow-y: auto; list-style-type: none; padding-left: 0;">
                    </ul>
            </div>
        </div>
    </div>
    
    <div id="facturas-impresion"></div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script type="module" src="script.js"></script>
</body>
</html>