<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consumo de Diésel</title>
    
    <link rel="icon" type="image/png" href="logo.png"> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header-container">
        <div class="header-content">
            <img src="logo.jpg" alt="Logo Obreco" class="header-logo">
            <div class="header-titles">
                <h1>GRUPO OBRECO CIA LTDA</h1>
                <h2>CONTROL DE DIÉSEL</h2>
            </div>
        </div>
    </div>
    
    <div id="vista-login" class="container">
        <h2><i class="fa-solid fa-lock"></i> Inicio de Sesión</h2>
        <form id="loginForm">
            <label for="loginEmail">Correo Electrónico:</label>
            <input type="email" id="loginEmail" required>
            <label for="loginPassword">Contraseña:</label>
            <input type="password" id="loginPassword" required>
            <button type="submit" class="button-primary"><i class="fa-solid fa-arrow-right-to-bracket"></i> Iniciar Sesión</button>
        </form>
        <p id="login-error" class="error-message"></p>
    </div>

    <div id="vista-app" class="container" style="display: none;">
        <div class="app-header">
            <h2 id="app-title">Dashboard</h2>
            <div class="app-controls">
                <button id="btnLogout" class="button-secondary"><i class="fa-solid fa-right-from-bracket"></i> Salir</button>
            </div>
        </div>
        
        <div class="dashboard-grid" id="nav-container">
            <button class="nav-button active" data-tab="tabDashboard"><i class="fa-solid fa-chart-line"></i> Dashboard</button>
            <button class="nav-button" data-tab="tabRegistrar"><i class="fa-solid fa-plus-circle"></i> Registrar</button>
            <button class="nav-button" data-tab="tabHistorial"><i class="fa-solid fa-table"></i> Historial</button>
            <button class="nav-button" data-tab="tabReportes"><i class="fa-solid fa-file-pdf"></i> Reportes</button>
            <button class="nav-button" data-tab="tabAdmin" id="btnAdmin"><i class="fa-solid fa-users-gear"></i> Administración</button>
        </div>

        <div class="tab-content">
            
            <div id="tabDashboard" class="tab active">
                <h3>Resumen Ejecutivo</h3>
                <div class="summary-container">
                    <div class="summary-card primary-bg">
                        <i class="fa-solid fa-gas-pump"></i>
                        <h4>Galones Registrados (Mes)</h4>
                        <p id="totalGalonesMes">0.00</p>
                    </div>
                    <div class="summary-card success-bg">
                        <i class="fa-solid fa-money-bill-wave"></i>
                        <h4>Costo Total (Mes)</h4>
                        <p id="costoTotalMes">$0.00</p>
                    </div>
                    <div class="summary-card info-bg">
                        <i class="fa-solid fa-truck-moving"></i>
                        <h4>Registros (Mes)</h4>
                        <p id="totalRegistrosMes">0</p>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h3>Consumo Mensual (Galones)</h3>
                    <canvas id="consumoChart"></canvas>
                </div>
                
                <div class="acordeon-container">
                    <button class="accordion-button"><i class="fa-solid fa-eye"></i> Vista de Observador</button>
                    <div class="accordion-panel">
                        <p>Solo personal autorizado tiene acceso a las pestañas de registro y administración.</p>
                        <p>Funcionalidades disponibles: Dashboard, Historial y Reportes.</p>
                    </div>
                </div>
            </div>

            <div id="tabRegistrar" class="tab">
                <h3>Registrar Nuevo Consumo de Diésel</h3>
                <button id="btnAbrirModalRegistro" class="button-primary"><i class="fa-solid fa-plus-circle"></i> Nuevo Registro</button>
                <div id="ultimosRegistros">
                    <h4>Últimos 10 Registros</h4>
                    <table id="tablaUltimosRegistros">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Volqueta</th>
                                <th>Galones</th>
                                <th>Costo</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
            
            <div id="modalRegistro" class="modal">
                <div class="modal-content">
                    <span class="close-button">&times;</span>
                    <div id="formularioContainer">
                        <h2 id="formularioTitulo">Nuevo Registro</h2>
                        <form id="consumoForm">
                            <input type="hidden" id="registroId">
                            <label for="fecha">Fecha:</label>
                            <input type="date" id="fecha" required>
                            <label for="hora">Hora de Carga:</label>
                            <input type="time" id="hora">

                            <label for="selectChofer">Nombre del Chofer:</label>
                            <select id="selectChofer" required></select>
                            
                            <label for="selectVolqueta">Placa de la Volqueta:</label>
                            <select id="selectVolqueta" required></select>
                            
                            <label for="selectDetallesVolqueta">Detalles Volqueta:</label>
                            <select id="selectDetallesVolqueta"></select> 
                            
                            <label for="kilometraje">Kilometraje:</label>
                            <input type="number" id="kilometraje" step="any" placeholder="Ej: 150230.5">
                            
                            <label for="selectProveedor">Proveedor de Diesel:</label>
                            <select id="selectProveedor" required></select>
                            
                            <label for="selectProyecto">Proyecto:</label>
                            <select id="selectProyecto" required></select>
                            
                            <label for="galones">Galones de Diésel (Volumen):</label>
                            <input type="number" id="galones" step="0.01" required>
                            
                            <label for="costo">Costo Total ($):</label>
                            <input type="number" id="costo" step="0.01" required>
                            
                            <label for="selectEmpresa">Empresa:</label>
                            <select id="selectEmpresa" required></select>
                            
                            <label for="descripcion">Descripción del Uso:</label>
                            <textarea id="descripcion" required></textarea>
                            
                            <button type="submit" id="btnGuardar" class="button-primary"><i class="fa-solid fa-floppy-disk"></i> Guardar Registro</button>
                        </form>
                    </div>
                </div>
            </div>

            <div id="tabHistorial" class="tab">
                <h3>Historial de Registros</h3>
                <div class="filter-controls">
                    <div class="filter-group">
                        <label for="filtroMesHistorial">Filtrar por Mes:</label>
                        <select id="filtroMesHistorial"></select>
                    </div>
                    <div class="filter-group">
                        <label for="filtroVolquetaHistorial">Filtrar por Volqueta:</label>
                        <select id="filtroVolquetaHistorial"></select>
                    </div>
                </div>
                
                <table id="tablaHistorial">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Volqueta</th>
                            <th>Chofer</th>
                            <th>Galones</th>
                            <th>Costo</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>

            <div id="tabReportes" class="tab print-area">
                <h3>Generación de Reportes</h3>
                <div class="report-controls">
                    <div class="filter-group">
                        <label for="filtroMesReportes">Reporte Mensual:</label>
                        <select id="filtroMesReportes"></select>
                    </div>
                    <button class="btn-print button-info" data-print-target="tabReportes"><i class="fa-solid fa-print"></i> Imprimir Reporte</button>
                    <button class="btn-print-excel button-success"><i class="fa-solid fa-file-excel"></i> Exportar a Excel</button>
                </div>

                <div id="reporteContenido">
                    <div class="report-summary">
                        <h4>Resumen del Mes: <span id="reporteMesActual"></span></h4>
                        <div class="summary-container">
                            <div class="summary-card success-bg">
                                <h4>Galones Consumidos</h4>
                                <p id="reporteTotalGalones">0.00</p>
                            </div>
                            <div class="summary-card danger-bg">
                                <h4>Costo Total</h4>
                                <p id="reporteCostoTotal">$0.00</p>
                            </div>
                        </div>
                    </div>

                    <div class="report-section">
                        <h4>Consumo por Volqueta</h4>
                        <table id="reporteVolqueta">
                            <thead>
                                <tr>
                                    <th>Volqueta</th>
                                    <th>Galones</th>
                                    <th>Costo</th>
                                    <th>Registros</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div class="report-section">
                        <h4>Consumo por Chofer</h4>
                        <table id="reporteChofer">
                            <thead>
                                <tr>
                                    <th>Chofer</th>
                                    <th>Galones</th>
                                    <th>Costo</th>
                                    <th>Registros</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div class="report-section">
                        <h4>Detalle de Transacciones</h4>
                        <table id="reporteDetalle">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Hora</th>
                                    <th>Volqueta</th>
                                    <th>Chofer</th>
                                    <th>Proyecto</th>
                                    <th>Proveedor</th>
                                    <th>Galones</th>
                                    <th>Costo</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="tabAdmin" class="tab">
                <h3>Gestión de Listas Maestras</h3>
                <div class="admin-grid">
                    
                    <div class="admin-box">
                        <h3><i class="fa-solid fa-user-tie"></i> Gestionar Choferes</h3>
                        <form id="formAdminChofer" class="admin-form">
                            <input type="text" id="nuevoChofer" placeholder="Nombre completo del chofer" required>
                            <button type="submit" class="button-success"><i class="fa-solid fa-plus"></i> Agregar</button>
                        </form>
                        <ul id="listaChoferes" class="lista-gestion"></ul>
                    </div>
                    
                    <div class="admin-box">
                        <h3><i class="fa-solid fa-truck"></i> Gestionar Placas</h3>
                        <form id="formAdminPlaca" class="admin-form">
                            <input type="text" id="nuevaPlaca" placeholder="Placa de la volqueta" required>
                            <button type="submit" class="button-success"><i class="fa-solid fa-plus"></i> Agregar</button>
                        </form>
                        <ul id="listaPlacas" class="lista-gestion"></ul>
                    </div>
                    
                    <div class="admin-box">
                        <h3><i class="fa-solid fa-tags"></i> Gestionar Detalles Volqueta</h3>
                        <form id="formAdminDetalle" class="admin-form">
                            <input type="text" id="nuevoDetalle" placeholder="Ej: Doble Eje, Tritón Rojo" required>
                            <button type="submit" class="button-success"><i class="fa-solid fa-plus"></i> Agregar</button>
                        </form>
                        <ul id="listaDetalles" class="lista-gestion"></ul>
                    </div>

                    <div class="admin-box">
                        <h3><i class="fa-solid fa-building"></i> Gestionar Empresas</h3>
                        <form id="formAdminEmpresa" class="admin-form">
                            <input type="text" id="nuevaEmpresa" placeholder="Nombre de la empresa" required>
                            <button type="submit" class="button-success"><i class="fa-solid fa-plus"></i> Agregar</button>
                        </form>
                        <ul id="listaEmpresas" class="lista-gestion"></ul>
                    </div>

                    <div class="admin-box">
                        <h3><i class="fa-solid fa-dolly"></i> Gestionar Proveedores</h3>
                        <form id="formAdminProveedor" class="admin-form">
                            <input type="text" id="nuevoProveedor" placeholder="Nombre del proveedor" required>
                            <button type="submit" class="button-success"><i class="fa-solid fa-plus"></i> Agregar</button>
                        </form>
                        <ul id="listaProveedores" class="lista-gestion"></ul>
                    </div>

                    <div class="admin-box">
                        <h3><i class="fa-solid fa-list-check"></i> Gestionar Proyectos</h3>
                        <form id="formAdminProyecto" class="admin-form">
                            <input type="text" id="nuevoProyecto" placeholder="Nombre del proyecto" required>
                            <button type="submit" class="button-success"><i class="fa-solid fa-plus"></i> Agregar</button>
                        </form>
                        <ul id="listaProyectos" class="lista-gestion"></ul>
                    </div>
                </div>
            </div>
            
            <div class="signature-block"><div class="line"></div>Ing. José L. Macas P.<br>RESIDENTE DE OBRA</div>

            <div class="credits">
                APLICACION ELABORADA POR: ING. JOSE LUIS MACAS P.
            </div>
        </div>
    </div>
    
    <div id="facturas-impresion"></div>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="script.js" type="module"></script>
</body>
</html>